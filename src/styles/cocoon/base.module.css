/* Cocoon Metamorphosis - Base Styles */

.cocoonContainer {
    position: relative;
    width: 100%;
    max-width: 500px;
    aspect-ratio: 2/3;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    perspective: 1000px;
}

.cocoonWrapper {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
}

.cocoonWrapper:hover {
    transform: scale(1.02);
}

/* ==================== STAGE 1: SEALED COCOON ==================== */
.sealedCocoon {
    position: relative;
    width: 80%;
    height: 90%;
    background: linear-gradient(135deg, #8B7355 0%, #5D4E37 100%);
    border-radius: 45% 45% 50% 50% / 60% 60% 40% 40%;
    box-shadow:
        inset 0 -20px 40px rgba(0, 0, 0, 0.3),
        inset 0 20px 40px rgba(255, 255, 255, 0.1),
        0 20px 60px rgba(0, 0, 0, 0.4);
    animation: breathe 4s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
}

.sealedCocoon::before {
    content: '';
    position: absolute;
    inset: 10%;
    background: linear-gradient(135deg,
            rgba(255, 255, 255, 0.1) 0%,
            transparent 50%,
            rgba(0, 0, 0, 0.2) 100%);
    border-radius: inherit;
    pointer-events: none;
}

.sealedCocoon::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 30% 30%,
            rgba(255, 255, 255, 0.2) 0%,
            transparent 60%);
    border-radius: inherit;
    animation: subtlePulse 2s ease-in-out infinite;
}

.silkTexture {
    position: absolute;
    inset: 0;
    background-image:
        repeating-linear-gradient(45deg,
            transparent,
            transparent 2px,
            rgba(255, 255, 255, 0.03) 2px,
            rgba(255, 255, 255, 0.03) 4px),
        repeating-linear-gradient(-45deg,
            transparent,
            transparent 2px,
            rgba(0, 0, 0, 0.03) 2px,
            rgba(0, 0, 0, 0.03) 4px);
    border-radius: inherit;
    pointer-events: none;
}

/* ==================== STAGE 2: EARLY STIRRING ==================== */
.earlyStirring {
    composes: sealedCocoon;
    animation: breathe 3s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite,
        glowPulse 2s ease-in-out infinite;
    --glow-color: rgba(255, 165, 0, 0.4);
}

.crack {
    position: absolute;
    width: 2px;
    height: 100%;
    background: linear-gradient(to bottom,
            transparent 0%,
            #FFD700 20%,
            #FFA500 50%,
            #FFD700 80%,
            transparent 100%);
    filter: drop-shadow(0 0 4px #FFD700);
    animation: crackGlow 1.5s ease-in-out infinite;
    transform-origin: center;
}

.crack1 {
    left: 30%;
    transform: rotate(15deg);
}

.crack2 {
    left: 50%;
    transform: rotate(-10deg);
}

.crack3 {
    right: 30%;
    transform: rotate(20deg);
}

/* ==================== STAGE 3: BREAKING THROUGH ==================== */
.breakingThrough {
    position: relative;
    width: 80%;
    height: 90%;
}

.cocoonShell {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #8B7355 0%, #5D4E37 100%);
    border-radius: 45% 45% 50% 50% / 60% 60% 40% 40%;
    box-shadow:
        inset 0 -20px 40px rgba(0, 0, 0, 0.3),
        0 20px 60px rgba(0, 0, 0, 0.4);
}

.majorCrack {
    position: absolute;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom,
            transparent 0%,
            #FFEB3B 10%,
            #FFF176 50%,
            #FFEB3B 90%,
            transparent 100%);
    filter: drop-shadow(0 0 8px #FFEB3B) drop-shadow(0 0 16px #FFA500);
    animation: crackGlow 1s ease-in-out infinite;
}

.lightBeam {
    position: absolute;
    width: 3px;
    height: 150px;
    background: linear-gradient(to bottom,
            rgba(255, 235, 59, 0) 0%,
            rgba(255, 235, 59, 0.8) 50%,
            rgba(255, 235, 59, 0) 100%);
    filter: blur(2px);
    animation: lightBeam 2s ease-in-out infinite;
    transform-origin: top center;
}

.innerGlow {
    position: absolute;
    inset: 20%;
    background: radial-gradient(ellipse at center,
            rgba(255, 235, 59, 0.6) 0%,
            rgba(255, 165, 0, 0.3) 50%,
            transparent 100%);
    border-radius: 50%;
    animation: intensifyGlow 2s ease-in-out infinite;
}

.fragment {
    position: absolute;
    background: linear-gradient(135deg, #D4A574 0%, #8B7355 100%);
    border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    box-shadow:
        inset 0 -5px 10px rgba(0, 0, 0, 0.3),
        0 5px 15px rgba(0, 0, 0, 0.4);
    animation: fragmentFall 2s ease-in forwards;
}

/* ==================== STAGE 4: EMERGENCE ==================== */
.emergence {
    position: relative;
    width: 80%;
    height: 90%;
    animation: emerge 3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.chrysalis {
    position: relative;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
            #4A90E2 0%,
            #7B68EE 50%,
            #DA70D6 100%);
    background-size: 200% 200%;
    border-radius: 40% 40% 50% 50% / 50% 50% 40% 40%;
    box-shadow:
        inset 0 -20px 40px rgba(0, 0, 0, 0.2),
        inset 0 20px 40px rgba(255, 255, 255, 0.2),
        0 20px 60px rgba(123, 104, 238, 0.5);
    animation: chrysalisShimmer 4s ease-in-out infinite;
}

.wingBud {
    position: absolute;
    width: 30%;
    height: 40%;
    top: 30%;
    background: linear-gradient(to right,
            rgba(123, 104, 238, 0.6),
            rgba(218, 112, 214, 0.4));
    border-radius: 50% 0 0 50%;
    filter: blur(8px);
    opacity: 0.7;
    animation: unfurlWings 4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.wingBudLeft {
    composes: wingBud;
    left: -10%;
    transform-origin: right center;
}

.wingBudRight {
    composes: wingBud;
    right: -10%;
    transform-origin: left center;
    transform: scaleX(-1);
}

.magicParticle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: radial-gradient(circle, #DA70D6 0%, transparent 70%);
    border-radius: 50%;
    filter: blur(1px);
    animation: float 3s ease-in-out infinite, sparkle 2s ease-in-out infinite;
}

/* ==================== STAGE 5: WING UNFURLING ==================== */
.wingUnfurling {
    position: relative;
    width: 90%;
    height: 90%;
}

.butterflyBody {
    position: absolute;
    width: 20%;
    height: 60%;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(to bottom,
            #4A4A4A 0%,
            #2C2C2C 100%);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    box-shadow:
        inset 0 -10px 20px rgba(0, 0, 0, 0.5),
        0 10px 30px rgba(0, 0, 0, 0.4);
    z-index: 10;
}

.wing {
    position: absolute;
    width: 45%;
    height: 55%;
    top: 25%;
    background: linear-gradient(135deg,
            #FF1493 0%,
            #FF69B4 25%,
            #9370DB 50%,
            #00CED1 75%,
            #20B2AA 100%);
    background-size: 300% 300%;
    border-radius: 50% 50% 50% 0;
    box-shadow:
        inset 0 -10px 30px rgba(0, 0, 0, 0.2),
        0 10px 40px rgba(255, 20, 147, 0.4);
    animation:
        unfurlWings 4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
        wingColorReveal 4s ease-out forwards,
        iridescentShimmer 6s ease-in-out infinite;
}

.wingLeft {
    composes: wing;
    left: 0;
    transform-origin: right center;
    border-radius: 50% 0 0 50%;
}

.wingRight {
    composes: wing;
    right: 0;
    transform-origin: left center;
    border-radius: 0 50% 50% 0;
}

.wingPattern {
    position: absolute;
    inset: 10%;
    background-image: radial-gradient(circle at 30% 30%,
            rgba(255, 255, 255, 0.3) 0%,
            transparent 40%),
        radial-gradient(circle at 70% 70%,
            rgba(0, 0, 0, 0.2) 0%,
            transparent 40%);
    border-radius: inherit;
}

/* ==================== STAGE 6: FIRST FLIGHT ==================== */
.firstFlight {
    position: relative;
    width: 100%;
    height: 100%;
    animation: flutter 3s ease-in-out infinite;
}

.flyingButterfly {
    position: relative;
    width: 90%;
    height: 90%;
    animation: hover 4s ease-in-out infinite;
}

.flyingWing {
    position: absolute;
    width: 45%;
    height: 55%;
    top: 25%;
    background: linear-gradient(135deg,
            #FF1493 0%,
            #FFD700 33%,
            #00CED1 66%,
            #9370DB 100%);
    background-size: 300% 300%;
    border-radius: 50% 50% 50% 0;
    box-shadow:
        0 10px 40px rgba(255, 20, 147, 0.5),
        0 20px 60px rgba(255, 215, 0, 0.3);
    animation:
        wingFlap 0.3s ease-in-out infinite,
        iridescentShimmer 4s ease-in-out infinite;
}

.flyingWingLeft {
    composes: flyingWing;
    left: 0;
    border-radius: 50% 0 0 50%;
}

.flyingWingRight {
    composes: flyingWing;
    right: 0;
    border-radius: 0 50% 50% 0;
}

/* ==================== STAGE 7: MAJESTIC BUTTERFLY ==================== */
.majesticButterfly {
    position: relative;
    width: 100%;
    height: 100%;
    animation: majesticFlight 8s cubic-bezier(0.4, 0.0, 0.2, 1) infinite;
}

.majesticWing {
    position: absolute;
    width: 48%;
    height: 60%;
    top: 20%;
    background: linear-gradient(135deg,
            #8B00FF 0%,
            #4169E1 20%,
            #FF1493 40%,
            #FFD700 60%,
            #00CED1 80%,
            #FF69B4 100%);
    background-size: 400% 400%;
    border-radius: 50% 50% 50% 0;
    box-shadow:
        0 0 30px rgba(139, 0, 255, 0.6),
        0 0 60px rgba(65, 105, 225, 0.4),
        0 10px 80px rgba(255, 20, 147, 0.5);
    animation:
        wingFlap 0.25s ease-in-out infinite,
        iridescentShimmer 3s ease-in-out infinite,
        cosmicAura 4s ease-in-out infinite,
        etherealGlow 5s ease-in-out infinite;
}

.majesticWingLeft {
    composes: majesticWing;
    left: 0;
    border-radius: 50% 0 0 50%;
}

.majesticWingRight {
    composes: majesticWing;
    right: 0;
    border-radius: 0 50% 50% 0;
}

.cosmicAura {
    position: absolute;
    inset: -20%;
    background: radial-gradient(ellipse at center,
            rgba(139, 0, 255, 0.3) 0%,
            rgba(65, 105, 225, 0.2) 30%,
            rgba(255, 20, 147, 0.1) 60%,
            transparent 100%);
    border-radius: 50%;
    animation: cosmicAura 4s ease-in-out infinite;
    pointer-events: none;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .cocoonContainer {
        max-width: 350px;
    }
}

@media (max-width: 480px) {
    .cocoonContainer {
        max-width: 280px;
    }

    .wing,
    .flyingWing,
    .majesticWing {
        width: 44%;
    }
}